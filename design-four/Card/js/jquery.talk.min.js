function storyController(e) {
    current = 0, local || Parse.initialize("bXR1spQKnockXOYWs65m68f1yREQCU0uUqlMFJ8J", "WSQLkkafg4dzgbZv22EdA7D3FAlns8826XFQllpC"), createMessage(e[0].question)
}
function createMessage(e, o, a) {
    o = "undefined" != typeof o ? o : 0, a = "undefined" != typeof a ? a : 0;
    var s = '<div class="line"><div class="message message-left animated fadeInUp">', i = "</div></div>", n = o > 0 ? calculateDelay(e[o - 1]): 1e3;
    !a && questions[currentQuestion].intro && 0 == o && (n = 50), setTimeout(function() {
        return o >= e.length ? a ? (currentQuestion++, createMessage(questions[currentQuestion].question), 1) : (createAnswerField(n), 1) : ($("#container").append(s + e[o] + i), smoothScrollBottom(), o++, createMessage(e, o, a), void 0)
    }, n)
}
function createAnswerField() {
    var e = '<div id="answer-container" class="line"><form action="#" onsubmit="return false;"><input type="text" name="answer" id="answer" class="message message-right animated fadeInUp" value="" placeholder="Write a response…"></form><div class="clear"></div></div>';
    return questions[currentQuestion].ending ? 1 : ($("#container").append(e), $("#answer").keyup(function(e) {
        if (13 == e.keyCode) {
            var o = $.trim($("#answer").val());
            "" != o ? ($("#answer-container").remove(), createAnswerMessage(o)) : ($("#answer").removeClass("shake").removeClass("fadeInUp"), $("#answer").addClass("shake"), $("#answer").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend", function() {
                $(this).removeClass("shake").removeClass("fadeInUp")
            }))
        }
    }), $("#answer").focus(), void smoothScrollBottom())
}
function createAnswerMessage(e) {
    var o = '<div class="line"><div class="message message-right animated pulse">', a = '</div></div><div class="clear"></div>';
    $("#container").append(o + e + a), local && (console.log(e), console.log(questions[currentQuestion]));
    var s = {
        question: questions[currentQuestion].name,
        answer: e,
        created_at: String(Date.now())
    };
    local ? console.log(s) : Parse.Analytics.track("read", s), createMessage(findResponseForAnswer(e, questions[currentQuestion].answers), 0, 1)
}
function findResponseForAnswer(e, o) {
    for (key in o)
        if (e.toLowerCase().match(key))
            return o[key].replies;
    return o["default"].replies
}
function calculateDelay(e) {
    var o = 218, a = e.split(" ").length * o;
    return a = 3 * o > a ? a + 400 : a
}
function smoothScrollBottom() {
    $("html,body").animate({
        scrollTop: $(document).height()
    }, 1e3)
}
function openCloseMenu() {
    $menu = $("#menu"), $overlay = $("#menu-overlay"), $mainContent = $("#container");
    var e=!0;
    $menu.click(function() {
        e && ($(this).hasClass("active") ? ($menu.removeClass("active"), e=!1, $overlay.removeClass("fadeIn").addClass("fadeOut"), $mainContent.removeClass("blur"), $overlay.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend", function() {
            $(this).hide().removeClass("fadeOut"), e=!0
        })) : ($menu.addClass("active"), e=!1, $overlay.show().addClass("fadeIn"), $mainContent.addClass("blur"), $overlay.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend", function() {
            e=!0
        })))
    })
}
var questions = {
    0: {
        name: "name",
        intro: !0,
        question: ["Hey Mom.", "Happy Mother's Day", "How's your day?"],
        answers: {
            "default": {
                replies: ["I am not sure I can feel that way"]
            },
            "good": {
                replies: ["I'm glad to hear that.", "After all, today is all about you."]
            },
            "bad": {
                replies: ["I bet it is something that James did", "He can be a little annoying."]
            },
            "okay": {
                replies: ["Hopefully it gets better.", "The presents I got you should help with your day."]
            },
            "not bad": {
                replies: ["Ha well it should be worse", "right."]
            },
        }
    },
    1: {
        name: "city",
        question: ["On a scale of 1-10, how much do you think you mean to me?"],
        answers: {
            "default": {
                replies: ["That's interesting", "There isn't actually a number."]
            },
            "1|2|3|4|5|6|7|8|9": {
                replies: ["You're not even close", "There isn't actually a number."]
            },
            "10": {
                replies: ["Ah.", "Nice guess", "Actually there isn't a number."]
            }, 
            "11": {
                replies: ["Last time I checked 11 was greater than 10", "Well this is awkward...", "However, there isn't an exact number."]
            }
            
        }
    },
    2: {
        name: "know me from",
        question: ["I am not sure what I would do without you.", "It's hard to imagaine a day where I don't see you.",
                    "Let's not get too sappy already.",'<img width="100%" src="./mom-and-i.jpg" />' , "Do you remember this day?" ],
        answers: {
            "default": {
                replies: ["Well I remember it", "That was on September 29, 2009", "That was a very good day"]
            },
            "yes": {
                replies: ["I do too.", "That was on September 29, 2009", "That was a very good day"]
            }
        }
    },
    3: {
        name: "job",
        question: ["A lot has changed since that day","However there are still things that will never change","<ul><li>I still love you.</li><li>I still annoy you.</li><li>Your favourite colour is still Purple.</li><li>Mother's day happens every year.</li?</ul>", "I know I don't say this often but I love you.", "I don't know where I'd be without and I am forever grateful for everything you do for me.", "I know somedays I annoy the living crap out of you but I do it with love ❤❤", "Thank you for everything and Happy Mothers day.", "Love Ryan ❤❤"],
        answers: {
            "default": {
                replies: []
            }
        }
    },
}, currentQuestion = 0, lastQuestion = questions.length - 1, local=!document.location.hostname;
$(document).ready(function() {
    new storyController(questions), new openCloseMenu
});

